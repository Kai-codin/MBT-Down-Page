<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checking Site Status</title>
    <script>
        // Function to check if the main site is up
        async function checkMainSite(url) {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000); // 5-second timeout

                const response = await fetch('https://www.mybustimes.cc', {
                    method: 'HEAD',
                    mode: 'no-cors',
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (response.type === 'opaque') {
                    // If the main site is up, redirect to the target URL
                    window.location.href = url;
                } else {
                    // If the main site is not up, show an error message
                    window.location.href = 'down.html';
                }
            } catch (error) {
                // On error (e.g., timeout), show an error message
                window.location.href = 'down.html';
            }
        }

        // Function to preload the target page
        function preloadTargetPage(url) {
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none'; // Hide the iframe
            iframe.src = url; // Set the target URL for preloading
            document.body.appendChild(iframe); // Append iframe to the body to start loading
        }

        // Call the check function when the page loads
        window.onload = function() {
            // Replace the current page in history with a new one
            history.replaceState(null, null, window.location.href);

            const url = new URLSearchParams(window.location.search).get('url');
            if (url) {
                // Start preloading the target page
                preloadTargetPage(url);
                // Perform the check for the main site
                checkMainSite(url);
            }
        }
    </script>
</head>
<body>
</body>
</html>
